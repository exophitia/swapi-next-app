## SWAPI type generation

This project generates most TypeScript types **automatically** from the SWAPI API.

### Overview

- Script: `scripts/generate-types.mjs`
- NPM script: `npm run generate:types`
- Generated types:
  - Single-entity types per resource (e.g. `People`, `Films`, …) in `lib/types/*.ts`
  - An overview type for the SWAPI root response (`SwapiRoot`) in `lib/types/root.ts`
  - A central type index (`SwapiResourceItem`, `SwapiResourceKey`, re-exports) in `lib/types/index.ts`
- **Zod schemas** are generated from the same samples and written to `lib/swapi-schemas.ts` (`swapiRootSchema`, `resourcePageResponseSchema`). They are used at runtime to validate API responses. One run of `npm run generate:types` updates both types and Zod schemas.

### Requirements

- Node.js **>= 20.9.0** (see `engines.node` in `package.json`)
- `quicktype` is already installed as a dev dependency (`devDependencies.quicktype`)

### How generation works

The script `scripts/generate-types.mjs` does four main things:

1. **Fetch the SWAPI root response**

   ```ts
   const res = await fetch(`${SWAPI_BASE}/`);
   const data = await res.json();
   ```

2. **Generate `SwapiRoot` from the root response**

   - Save the full root payload to `samples/root.json`.
   - Call `quicktype`:

     ```bash
     npx quicktype "samples/root.json" \
       -o "lib/types/root.ts" \
       --just-types \
       --top-level SwapiRoot
     ```

   - Result: `lib/types/root.ts` with something like:

     ```ts
     export interface SwapiRoot {
       people:    string;
       planets:   string;
       films:     string;
       species:   string;
       vehicles:  string;
       starships: string;
     }
     ```

3. **Generate one example entity per resource and its type**

   - Determine valid resource keys from the root response:

     ```ts
     const keys = Object.keys(data).filter(
       (k) => typeof data[k] === "string" && data[k].startsWith("http")
     );
     ```

   - For each key (`people`, `planets`, …):
     - Try to fetch `GET /<resource>/1/`.
     - If that fails, fall back to the first entity from `GET /<resource>/?page=1`.
     - Save the example entity to `samples/<resource>.json`.
     - Call `quicktype` with `--top-level <CapitalizedResource>`, e.g.:

       ```bash
       npx quicktype "samples/people.json" \
         -o "lib/types/people.ts" \
         --just-types \
         --top-level People
       ```

4. **Generate `lib/types/index.ts`**

   - Based on the discovered resource keys, the script also writes `lib/types/index.ts`:

     ```ts
     // AUTO-GENERATED BY scripts/generate-types.mjs. DO NOT EDIT BY HAND.
     // Run `npm run generate:types` to regenerate.
     //
     export type { People } from "./people";
     export type { Planets } from "./planets";
     export type { Films } from "./films";
     export type { Species } from "./species";
     export type { Vehicles } from "./vehicles";
     export type { Starships } from "./starships";
     export type { SwapiRoot } from "./root";
     //
     import type { People } from "./people";
     import type { Planets } from "./planets";
     import type { Films } from "./films";
     import type { Species } from "./species";
     import type { Vehicles } from "./vehicles";
     import type { Starships } from "./starships";
     import type { SwapiRoot } from "./root";
     //
     /** Union of all SWAPI resource item types (single entity from API). */
     export type SwapiResourceItem =
       | People
       | Planets
       | Films
       | Species
       | Vehicles
       | Starships;
     //
     /** Resource keys that have a list endpoint and detail endpoint. */
     export type SwapiResourceKey = keyof SwapiRoot;
     ```

   - Both `SwapiResourceItem` and `SwapiResourceKey` are now **fully generated** based on the current SWAPI schema. No manual updates are required when adding new resources.

### Using the types in code

Examples from `lib/swapi-routes.ts`:

- **Root response & keys:**

  ```ts
  import type { SwapiResourceItem, SwapiResourceKey, SwapiRoot } from "@/lib/types";

  export async function getSwapiResourceKeys(): Promise<string[]> {
    const res = await fetch(`${SWAPI_BASE}/`, fetchOptions);
    const data = (await res.json()) as SwapiRoot;

    return (Object.keys(data) as (keyof SwapiRoot)[]).filter(
      (key): key is SwapiResourceKey =>
        typeof data[key] === "string" && data[key].startsWith("http")
    );
  }
  ```

- **List response:**

  ```ts
  export type ResourcePageResponse = {
    count: number;
    next: string | null;
    previous: string | null;
    results: SwapiResourceItem[];
  };
  ```

- **Detail entity & display helpers:**

  ```ts
  export async function getResourceItem(
    resource: string,
    id: string
  ): Promise<SwapiResourceItem | null> { ... }

  export function getDisplayName(item: SwapiResourceItem): string { ... }

  export function getDisplayableEntries(
    item: SwapiResourceItem
  ): [string, string | number][] { ... }
  ```

### When do you need manual changes?

In most cases, running `npm run generate:types` is enough. Manual changes are only needed if the API changes in ways that the generator cannot fully capture:

1. **New SWAPI resource added**

   - Run `npm run generate:types`.
   - Verify that:
     - `lib/types/<new>.ts` exists.
     - `lib/types/root.ts` includes the new key.
     - `lib/types/index.ts` exports the new type and includes it in `SwapiResourceItem`.
   - If you want to use the new resource in the app, adjust `SwapiResourceKey`-dependent code (e.g. navigation, pages).

2. **Existing resource structure changes significantly**

   - Run `npm run generate:types` to regenerate the TS types based on the latest example entity.
   - If certain fields should be mandatory for your app logic, you can tighten the generated types manually (e.g. making optional properties required).

3. **Root response shape changes**

   - Run `npm run generate:types` to regenerate `SwapiRoot`.
   - Adapt any code that relies on particular root keys (e.g. navigation, resource discovery).

### Quick guide for new team members

1. API schema changed?  
   → Run:

   ```bash
   npm run generate:types
   ```

2. Verify:
   - `lib/types/*` (especially `root.ts` and `<resource>.ts`)
   - `lib/types/index.ts` (auto-generated unions and exports)

3. Run lint & build:

   ```bash
   npm run lint
   npm run build
   ```

