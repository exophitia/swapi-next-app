---
description: "Working with generated SWAPI types and Zod validation"
globs:
  - "lib/**/*"
  - "scripts/generate-types.mjs"
alwaysApply: false
---

- **Single source of types**: Import SWAPI-related types exclusively from `lib/types/index.ts` (`SwapiResourceItem`, `SwapiResourceKey`, `SwapiRoot`, etc.), not directly from individual files in `lib/types/*.ts`.
- **Do not edit generated files manually**: Files with the header “AUTO-GENERATED BY scripts/generate-types.mjs” (e.g. in `lib/types/*` and `lib/swapi-schemas.ts`) must not be changed by hand. Apply changes via the script `scripts/generate-types.mjs` and `npm run generate:types` instead.
- **Reuse Zod schemas**: For root and list responses (e.g. `getSwapiResourceKeys`, `getResourcePage`) reuse the existing Zod schemas from `lib/swapi-schemas.ts` (`swapiRootSchema`, `resourcePageResponseSchema`) before introducing new schemas.
- **Schema and type changes**: When the SWAPI schema changes or new resources are added, run `npm run generate:types` first and then verify that `lib/types/*`, `lib/types/index.ts` and `lib/swapi-schemas.ts` were updated consistently.
- **Runtime validation for external data**: For new functions that process external SWAPI data, prefer a combination of TypeScript types (compile time) and Zod validation (runtime) instead of relying on type annotations alone.
- **Error handling for parsing**: When Zod parsing (`safeParse`) fails, explicitly define how the domain layer should react (e.g. empty array, `null`, or logged error) and handle that outcome consistently in the pages.

